#!/bin/bash
# ì‹¤ì‹œê°„ í¬ë¡¤ë§ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§

echo "================================================================================"
echo "ðŸ“Š ì‹¤ì‹œê°„ í¬ë¡¤ë§ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§"
echo "================================================================================"
echo ""

# í¬ë¡¤ëŸ¬ í”„ë¡œì„¸ìŠ¤ í™•ì¸
if ps aux | grep improved_multi_platform_crawler.py | grep -v grep > /dev/null; then
    echo "âœ… í¬ë¡¤ëŸ¬ ì‹¤í–‰ ì¤‘"
    ps aux | grep improved_multi_platform_crawler.py | grep -v grep | awk '{print "   PID:", $2, "| CPU:", $3"%", "| MEM:", $4"%", "| ì‹œìž‘:", $9}'
else
    echo "âŒ í¬ë¡¤ëŸ¬ê°€ ì‹¤í–‰ë˜ê³  ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤"
    exit 1
fi

echo ""
echo "================================================================================"
echo "ðŸ“ ìµœê·¼ ë¡œê·¸ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)"
echo "================================================================================"

# ìµœì‹  ë¡œê·¸ íŒŒì¼ ì°¾ê¸°
LATEST_LOG=$(ls -t logs/improved_crawl_*.log 2>/dev/null | head -1)

if [ -z "$LATEST_LOG" ]; then
    echo "ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    exit 1
fi

echo "ë¡œê·¸ íŒŒì¼: $LATEST_LOG"
echo ""

# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
tail -f "$LATEST_LOG" | while read line; do
    # ì¤‘ìš”í•œ ë¡œê·¸ë§Œ ì¶œë ¥
    if echo "$line" | grep -E "ë¸Œëžœë“œ ì²˜ë¦¬|ìˆ˜ì§‘ ì¤‘|ì €ìž¥ ì™„ë£Œ|ìˆ˜ì§‘ ì™„ë£Œ|ì—ëŸ¬|ì‹¤íŒ¨|ì„±ê³µ|í†µê³„" > /dev/null; then
        echo "$line"
    fi
done
